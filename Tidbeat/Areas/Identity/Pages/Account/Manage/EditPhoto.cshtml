@page
@model EditPhotoModel
@{
    string currentPhoto = await Model.GetUserPhotoUrlAsync();
}
<h1>Edit Photo</h1>

<div id="imageErrors" class="text-danger mb-2"></div>
<form method="post" enctype="multipart/form-data">
    <div class="form-group d-flex justify-content-center">
        <img id="preview" src="@(!string.IsNullOrEmpty(currentPhoto) ? currentPhoto : "/images/UnknownUser.jpg")" alt="User photo" width="200" height="200" class="rounded" style="object-fit: cover; outline: thick solid #000000; outline-width: 3px">
    </div>
    <div id="uploadPhoto" class="form-group mt-2">
        <input type="file" id="photoFile" name="photoFile">
    </div>
    <div class="mt-2">
        <button id="editButton" name="editButton" class="btn btn-primary">Alterar Foto</button>
    </div>
    <div class="d-flex align-items-center flex-column">
        <div class="form-group mt-2">
            <button id="saveButton" type="submit" name="saveButton" class="btn btn-primary">Guardar Foto</button>
        </div>
        <div class="">
            <button id="cancelButton" name="cancelButton" class="btn btn-danger my-2 text-danger" style="outline: thick solid #DC3545; outline-width: 3px">Cancelar</button>
        </div>
        <div class="form-group">
            <button id="deleteButton" type="submit" name="deleteButton" class="btn btn-danger text-danger @(currentPhoto == null ? "d-none" : "")" style="outline: thick solid #DC3545; outline-width: 3px">Apagar Foto</button>
        </div>
    </div>
</form>

<script>
    let uploadPhoto = document.getElementById("uploadPhoto");
    let photoFile = document.getElementById("photoFile");
    let editButton = document.getElementById("editButton");
    let cancelButton = document.getElementById("cancelButton");
    let saveButton = document.getElementById("saveButton");
    let deleteButton = document.getElementById("deleteButton");
    let imageErrors = document.getElementById("imageErrors");
    var editingMode = false;

    saveButton.style.display = "none";
    cancelButton.style.display = "none";
    uploadPhoto.style.display = "none";

    editButton.addEventListener("click", function (e) {
        e.preventDefault();
        editingMode = true;
        editButton.style.display = "none";
        cancelButton.style.display = "block";
        if (photoFile.value != "") {
            saveButton.style.display = "block";
        }
        deleteButton.style.display = "none";
        uploadPhoto.style.display = "block";
    });
    cancelButton.addEventListener("click", function () {
        e.preventDefault();
        editingMode = false;
        editButton.style.display = "block";
        cancelButton.style.display = "none";
        saveButton.style.display = "none";
        deleteButton.style.display = "block";
        photoFile.value = "";
        uploadPhoto.style.display = "none";
    });

    photoFile.addEventListener("change", function () {
        if (event.target.files[0].size > 512000) {
            imageErrors.innerHTML = "A imagem não pode ter mais de 500kb";
            photoFile.value = "";
            return;
        }
        var reader = new FileReader();
        reader.onload = function () {
            var preview = document.getElementById('preview');
            preview.src = reader.result;
            preview.style.display = 'block';
        }
        reader.readAsDataURL(event.target.files[0]);
        saveButton.style.display = "block";
    });

</script>