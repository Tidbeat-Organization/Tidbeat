@using Tidbeat.Controllers
@using Tidbeat.Services
@inject IMusicService MusicService
@inject ISpotifyService SpotifyService

@{
    ViewData["Title"] = "Musics Page";
}

<div class="mt-4 pt-5">
    <div class="mx-3 mt-10">
        <div id="filter" class="border border-3 border-dark rounded pb-2 mt-10">
            <div class="display-6 text-primary text-left d-flex w-2">Filtros</div>
            <div class="d-flex flex-row w-100">
                <div class="input-group d-flex flex-column">
                    <div class="align-self-start">Género:</div>
                    <div class="form-outline d-flex flex-row">
                        <img id="imgGender" class="no-padding align-self-center" src="~/images/SearchIcon.png" height="26" width="30" onclick="actualEvent()" />
                        <input type="search" id="formGender" class="form-control" placeholder="Search" value=@if (TempData.ContainsKey("Gener")){@TempData["Gener"];}/>
                    </div>
                </div>
                <div class="input-group d-flex flex-column">
                    <div class="align-self-start">Banda/Artista:</div>
                    <div class="form-outline  d-flex flex-row">
                        <img id="imgBand" class="no-padding align-self-center" src="~/images/SearchIcon.png" height="26" width="30" onclick="actualEvent()" />
                        <input type="search" id="formBand" class="form-control" placeholder="Search" value=@if (TempData.ContainsKey("Band")){@TempData["Band"];} />
                    </div>
                </div>
                <div class="input-group d-flex flex-column">
                    <div class="align-self-start">Álbum:</div>
                    <div class="form-outline  d-flex flex-row">
                        <img id="imgAlbum" class="no-padding align-self-center" src="~/images/SearchIcon.png" height="26" width="30" onclick="actualEvent()" />
                        <input type="search" id="formAlbum" class="form-control" placeholder="Search" value=@if (TempData.ContainsKey("Album")){@TempData["Album"];} />
                    </div>
                </div>
                <div class="input-group d-flex flex-column">
                    <div class="input-group d-flex flex-row h-50 align-items-end">
                        <div class="align-items-end d-flex">
                            <div class="align-self-start">Ano de Lançamento:</div>
                            <input id="formStartYear" type="number" class="form-control form-outline" placeholder="YYYY" min="1950" max="@DateTime.Now.Year" value=@if (TempData.ContainsKey("YearStar")){@TempData["YearStar"];}>
                            <div class="align-self-center">a</div>
                            <input id="formEndYear" type="number" class="form-control form-outline" placeholder="YYYY" min="1950" max="@DateTime.Now.Year" value=@if (TempData.ContainsKey("YearEnd")){@TempData["YearEnd"];}>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <h2 class="d-flex">Músicas</h2>
            @foreach (var item in ViewBag.Result.Tracks.Items)
            {
                <div id="@item.Uri" class="border border-3 border-primary rounded mt-2 d-flex justify-content-between mx-5">
                    <img src="@item.Album.Images[0].Url" alt="@item.Album.Name" width="45" height="45">
                    <div class="d-flex text-start align-content-start align-self-start font-weight-bold">@item.Name</div>
                     <div class="d-flex align-content-end pr-3"> de: @item.Artists[0].Name</div>
                </div>
            }
        </div>
    </div>
</div>

<script>
    function actualEvent(){
        let inputGener = document.getElementById("formGender");
        let inputAlbum = document.getElementById("formAlbum");
        let inputArtist = document.getElementById("formBand");
        let inputStartYear = document.getElementById("formStartYear");
        let inputEndYear = document.getElementById("formEndYear");
        let path = window.location.href.split("?")[0];
        if(inputGener.value || inputAlbum.value || inputArtist.value || inputStartYear.value.length===4 || inputEndYear.value.length===4){
            path+="?";
            let params = new URLSearchParams({
                searchKey: @if (TempData.ContainsKey("Search")){@TempData["Search"];},
                gener: inputGener.value,
                band: inputArtist.value,
                album: inputAlbum.value,
                yearStart: inputStartYear.value,
                yearEnd: inputEndYear.value,
            })
            path+=params.toString();
            console.log(window.location.href)
            window.location.href = path;
        }
        event.preventDefault();
    }
    document.getElementById("filter").addEventListener("keypress", function (event) {
           if(event.key === "Enter"){
            let focusElement = document.activeElement;
            let inputGener = document.getElementById("formGender");
            let inputAlbum = document.getElementById("formAlbum");
            let inputArtist = document.getElementById("formBand");
            let inputStartYear = document.getElementById("formStartYear");
            let inputEndYear = document.getElementById("formEndYear");
            if(inputGener === focusElement || inputAlbum === focusElement || inputArtist === focusElement || inputStartYear === focusElement || inputEndYear === focusElement){
            //only if one of the elements is higthligthed
                    event.preventDefault();
                    actualEvent();
            }
           }
        }
    )
    document.getElementById("imgGender").onclick = actualEvent;
    document.getElementById("imgAlbum").onclick = actualEvent;
    document.getElementById("imgBand").onclick = actualEvent;

</script>